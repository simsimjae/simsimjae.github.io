{"componentChunkName":"component---src-components-templates-page-template-js","path":"/posts/react/3","result":{"data":{"markdownRemark":{"html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 154px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/32258688165d42ebbf1b59b4bbffb13a/b7a03/2020_01_28_14_05_50.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.1038961038961%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABI0lEQVQoz2VRwaqCUBD1y/2Xto+QJFBSk1AiTUVcRJCEpmLgIhemlpa+Q1P28M3icu6Ze+aemWH6Vzwej+fzOeC2bYkhsuu6pmkulwvx/SeYAeFF/y+6T0RRdLvdRlmGajuOkyQJUev1WpKk1Wpl2zaRvu8LgiDLMs/zIMfin1cQxXFcXdewVxTFfD6HXtM08K7rKopCfZHNt1jXdc/zkAaeTCaqqkJQVVUYhizLlmUJ/ng8brdbgGE6b7EoitfrFZbO5/NisRhqbzab2Wy22+2AD4cDrgBpmsZx/BXjK5i83++maU6n0/1+HwQBatFrjADZ0+lEDS+XS8MwvtOmJgGyLLMsC4UhhguygCxGDUwDH/bCjBaDM89zbPUvM9oiLQ/gFxmy8f516dkHAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020 01 28 14 05 50\"\n        title=\"2020 01 28 14 05 50\"\n        src=\"/static/32258688165d42ebbf1b59b4bbffb13a/b7a03/2020_01_28_14_05_50.png\"\n        srcset=\"/static/32258688165d42ebbf1b59b4bbffb13a/b7a03/2020_01_28_14_05_50.png 154w\"\n        sizes=\"(max-width: 154px) 100vw, 154px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Next는 페이지에 <code class=\"language-text\">getInitialProps</code>가 없으면 해당 페이지는 <code class=\"language-text\">static</code>페이지라고 판단하여 <code class=\"language-text\">pre-render</code>한다.\n페이지를 pre-render한다는 말은 빌드할떄 그 페이지를 html파일로 만들어버린다는 얘기이다. 유저의 요청이 들어왔을때 서버에서 html파일을 만들어서 주는게 아니라\n미리 빌드할때 페이지를 만들어둔다. 그 페이지에서 비동기 요청을 해서 받아온 데이터로 마크업이 달라지지 않기 때문에 미리 빌드타임에 pre-render하는것이다.</p>\n<h2><code class=\"language-text\">pages/Homepage.js</code></h2>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> fetch <span class=\"token keyword\">from</span> <span class=\"token string\">'isomorphic-unfetch'</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">HomePage</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> stars <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>Next stars<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>stars<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n<span class=\"token punctuation\">}</span>\n\nHomePage<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">getInitialProps</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> req <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https://api.github.com/repos/zeit/next.js'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> json <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> res<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> stars<span class=\"token punctuation\">:</span> json<span class=\"token punctuation\">.</span>stargazers_count <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> HomePage</code></pre></div>\n<p>위 HomePage 페이지에는 <code class=\"language-text\">getInitialProps</code>가 존재하기 때문에 next는 이 페이지를 <code class=\"language-text\">pre-render</code>하지 않는다.\ngetInitialProps에서 비동기 요청으로 받아온 데이터로 마크업에 렌더링 할 수도 있기 떄문에 static 페이지로 만들수가없다.\ngetInitialProps가 있는 페이지는 서버사이드 렌더링 방식으로 동작하게 된다.</p>\n<p>넥스트는 <code class=\"language-text\">서버사이드렌더링</code>과 <code class=\"language-text\">static 페이지</code>를 적절히 섞어서 사용해서 최적화 해준다. 동적인 데이터 바인딩이 필요없는 페이지는 static page로 미리 만들어둬서 유저가 페이지를 빠르게 볼 수 있도록 하고,\n동적인 데이터 바인딩이 필요한 페이지는 서버사이드 렌더링으로 유저가 항상 그 페이지에서 최신 데이터를 볼 수 있게 해준다.</p>\n<blockquote>\n<p>static page도 일반 페이지들과 마찬가지로 유저와 상호작용 할 수 있다. 유저가 해당 페이지에서 어떤 컴포넌트를 클릭해도 클릭 이벤트를 처리 할 수 있다.\n넥스트가 알아서 hydrate 과정을 진행 해 주기 때문이다. </p>\n</blockquote>\n<h1>페이지에 getInitialProps가 없을때</h1>\n<p>넥스트는 해당 페이지를 <code class=\"language-text\">pre-render</code>하여 미리 html을 준비해둔다.\npre-render하는 동안에는(빌드타임) 라우터의 쿼리 객체는 비어있지만 <code class=\"language-text\">hydration</code>과정(리액트 컴포넌트가 이벤트를 수신할수있음) 후에 쿼리 객체를 사용할 수 있다.</p>\n<h1>next build 커맨드</h1>\n<p>이 커맨드를 입력하면 <code class=\"language-text\">getInitialProps</code>가 있는 페이지는 static html 페이지로 만들어진다.\n없는 페이지는 자바스크립트 파일로 만들어진다.</p>\n<p><code class=\"language-text\">about</code> 컴포넌트에 <code class=\"language-text\">getInitialProps</code> 없는 경우</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">.next/server/static/<span class=\"token variable\">${BUILD_ID}</span>/about.html</code></pre></div>\n<p>있는 경우</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">.next/server/static/<span class=\"token variable\">${BUILD_ID}</span>/about.js</code></pre></div>\n<h1>결론</h1>\n<p>넥스트에서 Automatic Static Optimization이란 pages 폴더 아래 모든 페이지에 대해서 getInitialProps가 있는지 없는지 판단해서\n해당 페이지를 <code class=\"language-text\">pre-render</code>할지 <code class=\"language-text\">server side rendering</code>할지를 결정하는 과정을 의미한다.</p>","frontmatter":{"path":"/posts/react/3","title":"[Next.js] Automatic Static Optimization","date":"January 31, 2020"}}},"pageContext":{}}}